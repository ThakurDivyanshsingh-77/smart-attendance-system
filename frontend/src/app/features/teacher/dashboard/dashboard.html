<mat-toolbar class="bg-white text-[#004643] px-8 shadow-sm flex justify-between items-center h-20 sticky top-0 z-50">
  <div class="flex items-center gap-3">
    <div class="w-10 h-10 bg-[#004643] rounded-lg flex items-center justify-center text-white">
      <mat-icon>school</mat-icon>
    </div>
    <div>
      <h1 class="text-lg font-bold leading-none">Smart Attendance</h1>
      <p class="text-xs text-gray-500 font-medium">Teacher Portal</p>
    </div>
  </div>

  <div class="flex items-center gap-6">
    <div class="hidden md:block text-right">
      <p class="text-sm font-bold text-[#004643]">{{ userName }}</p>
      <p class="text-xs text-gray-400">{{ currentDate | date:'fullDate' }}</p>
    </div>
    <button (click)="logout()" class="bg-red-50 text-red-600 p-2 rounded-full hover:bg-red-100 transition">
      <mat-icon>logout</mat-icon>
    </button>
  </div>
</mat-toolbar>

<div class="min-h-screen bg-[#F4F7F6] p-6 md:p-10 space-y-8">

  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    
    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4 hover:shadow-md transition">
      <div class="h-12 w-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center">
        <mat-icon>class</mat-icon>
      </div>
      <div>
        <p class="text-gray-400 text-xs font-bold uppercase">Total Classes</p>
        <h3 class="text-2xl font-black text-[#004643]">12</h3>
      </div>
    </div>

    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4 hover:shadow-md transition">
      <div class="h-12 w-12 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center">
        <mat-icon>check_circle</mat-icon>
      </div>
      <div>
        <p class="text-gray-400 text-xs font-bold uppercase">Avg Attendance</p>
        <h3 class="text-2xl font-black text-[#004643]">85%</h3>
      </div>
    </div>

    <button routerLink="/teacher/student-records" 
            class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4 hover:shadow-md hover:border-[#004643] transition group text-left">
      <div class="h-12 w-12 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-[#004643] group-hover:text-white transition">
        <mat-icon>groups</mat-icon>
      </div>
      <div>
        <p class="text-gray-400 text-xs font-bold uppercase group-hover:text-[#004643]">Students</p>
        <h3 class="text-lg font-bold text-[#004643]">View Records</h3>
      </div>
    </button>

    <button routerLink="/teacher/reports" 
            class="bg-[#004643] p-5 rounded-2xl shadow-lg text-white flex items-center justify-between hover:bg-[#003632] transition group">
      <div class="text-left">
        <p class="text-white/60 text-xs font-bold uppercase">Actions</p>
        <h3 class="text-lg font-bold">Attendance Reports</h3>
      </div>
      <mat-icon class="group-hover:translate-x-1 transition">arrow_forward</mat-icon>
    </button>

  </div>

  <div *ngIf="activeSession" class="animate-bounce-in">
    <div class="bg-gradient-to-r from-rose-500 to-pink-600 rounded-3xl shadow-xl p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden">
      <div class="absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
      
      <div class="flex items-center gap-6 z-10">
        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm animate-pulse">
          <mat-icon class="text-white text-3xl">sensors</mat-icon>
        </div>
        <div>
          <h2 class="text-2xl font-bold">Session in Progress</h2>
          <p class="text-white/90 font-medium mt-1 text-lg">
            {{ activeSession.subject?.name }}
            <span class="text-xs bg-black/20 px-2 py-1 rounded ml-2">{{ activeSession.subject?.code }}</span>
          </p>
        </div>
      </div>

      <button (click)="resumeSession()" 
              class="z-10 px-8 py-3 bg-white text-rose-600 font-bold rounded-xl shadow-lg hover:scale-105 transition flex items-center gap-2">
        Resume Now <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
  </div>


  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <div class="lg:col-span-2 bg-white rounded-[2rem] shadow-xl p-8 border border-gray-100">
      <h2 class="text-2xl font-extrabold text-[#004643] mb-2">Start Attendance</h2>
      <p class="text-gray-500 mb-8">Select subject details to generate a QR code.</p>

      <div class="bg-[#F8F9FA] p-6 rounded-3xl border border-gray-200/60">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
          
          <mat-form-field appearance="outline" class="w-full bg-white rounded-lg">
            <mat-label>Year</mat-label>
            <mat-select [formControl]="yearControl" (selectionChange)="onYearChange()">
              <mat-option [value]="1">1st Year</mat-option>
              <mat-option [value]="2">2nd Year</mat-option>
              <mat-option [value]="3">3rd Year</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full bg-white rounded-lg">
            <mat-label>Semester</mat-label>
            <mat-select [formControl]="semesterControl" (selectionChange)="onSemesterChange()">
              <mat-option *ngFor="let sem of semesters" [value]="sem">Semester {{ sem }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full bg-white rounded-lg">
            <mat-label>Subject</mat-label>
            <mat-select [formControl]="subjectControl">
              <mat-option *ngFor="let sub of subjects" [value]="sub._id">
                {{ sub.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </div>

        <button mat-flat-button (click)="startAttendance()"
                [disabled]="!yearControl.value || !semesterControl.value || !subjectControl.value"
                class="w-full mt-6 !py-6 !rounded-xl !text-lg !font-bold !bg-[#004643] text-white shadow-lg hover:shadow-xl hover:!bg-[#003632] transition disabled:opacity-50">
          <mat-icon class="mr-2">qr_code_2</mat-icon> Generate QR Code
        </button>
      </div>
    </div>

    <div class="bg-white rounded-[2rem] shadow-xl p-6 border border-gray-100 flex flex-col h-full">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-bold text-[#004643] flex items-center gap-2">
          <mat-icon class="text-red-500">warning</mat-icon> Low Attendance
        </h3>
        <a routerLink="/teacher/student-records" class="text-xs text-[#004643] font-bold underline cursor-pointer">View All</a>
      </div>

      <div class="overflow-y-auto space-y-4 pr-2 flex-grow max-h-[300px]">
        
        <div *ngFor="let student of defaulters" class="flex items-center justify-between p-3 rounded-xl bg-red-50 border border-red-100">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-red-200 text-red-700 flex items-center justify-center font-bold text-sm">
              {{ student.name.charAt(0) }}
            </div>
            <div>
              <p class="text-sm font-bold text-gray-800">{{ student.name }}</p>
              <p class="text-xs text-gray-500">Roll: {{ student.roll }}</p>
            </div>
          </div>
          <div class="text-right">
            <span class="text-red-600 font-bold text-sm">{{ student.attendance }}%</span>
            <mat-progress-bar mode="determinate" [value]="student.attendance" color="warn" class="w-16 h-1.5 rounded-full mt-1"></mat-progress-bar>
          </div>
        </div>

      </div>

      <button class="mt-4 w-full py-3 rounded-xl border border-gray-200 text-gray-600 font-bold hover:bg-gray-50 transition text-sm">
        Send Warning Email
      </button>
    </div>

  </div>
</div>